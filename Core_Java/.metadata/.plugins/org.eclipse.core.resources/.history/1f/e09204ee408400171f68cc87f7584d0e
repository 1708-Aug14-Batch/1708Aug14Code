package com.bank.tests;

import static org.junit.Assert.*;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Scanner;

import org.junit.After;
import org.junit.AfterClass;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;

import com.bank.dao.DaoTextImpl;
import com.bank.pojos.Account;
import com.bank.pojos.Account.accountType;
import com.bank.pojos.Clerk;
import com.bank.pojos.Person;
import com.bank.pojos.User;
import com.bank.service.Service;

public class BankTest {

	static DaoTextImpl daoImpl;
	static Service bankService;

	private static String testPersonFilename = DaoTextImpl.personFilename + "Test.txt";
	private static String testUserFilename = DaoTextImpl.userFilename + "Test.txt";
	private static String testClerkFilename = DaoTextImpl.clerkFilename + "Test.txt";

	// Copy over all of the data sets for safekeeping
	@BeforeClass
	public static void setUpBeforeClass() throws Exception {

		copyFile(DaoTextImpl.personFilename, testPersonFilename);
		copyFile(DaoTextImpl.userFilename, testUserFilename);
		copyFile(DaoTextImpl.clerkFilename, testClerkFilename);
		
		// Delete the files
		new File(personFilename).delete();
		new File(userFilename).delete();
		new File(clerkFilename).delete();
	}

	// Erase data created for the test
	// Restore the original data sets
	@AfterClass
	public static void tearDownAfterClass() throws Exception {

		// Restore original contents of files
		copyFile(testPersonFilename, DaoTextImpl.personFilename);
		copyFile(testUserFilename, DaoTextImpl.userFilename);
		copyFile(testClerkFilename, DaoTextImpl.clerkFilename);

		// Delete the test files
		new File(testPersonFilename).delete();
		new File(testUserFilename).delete();
		new File(testClerkFilename).delete();
	}

	@Before
	public void setUp() throws Exception {
		daoImpl = new DaoTextImpl();
		bankService = new Service();
		
	}

	@After
	public void tearDown() throws Exception {

	}

	@Test
	public void testService() {
		// duplicate SSNs, usernames, people with multiple accounts, incorrect SSNs, incorrect values
		// use delimiters in names and SSNs

		fail("Not yet implemented");
	}

	@Test
	public void testDaoTextImpl() {
		// create, read, update, delete
		Person per1 = new Person("123456789", "first name", "last name");
		per1.setEmail("myEmail@mail.com");
		Person per2 = new Person("987654321", "second first name", "second last name");
		Account acc = new Account(per1, "user name", "pass word", accountType.GOLD, 1);
		User guy = new User(per1, acc);
		Clerk cler = new Clerk(per2, 1);

		daoImpl.createPerson(per1);
		daoImpl.createPerson(per2);
		daoImpl.createUser(guy);
		daoImpl.createClerk(cler);

		System.out.println(daoImpl.readAllPersons());
		System.out.println(daoImpl.readAllUsers());
		System.out.println(daoImpl.readAllClerks());

		fail("Not fully implemented");
	}

	@Test
	public void testMain() {
		fail("Noit yet implemented");
	}

	private static boolean copyFile(String scanFilename, String writeFilename) {
		Scanner scan = null;

		try(BufferedWriter bw = new BufferedWriter(
				new FileWriter(writeFilename, false)))  {

			// Read from original file
			scan = new Scanner(new File(scanFilename));
			// Write to new file


			while (scan.hasNext())
				bw.write(scan.nextLine() + "\n");

			bw.close();
			scan.close();
		} catch (FileNotFoundException e) {
			e.printStackTrace();
			return false;
		} catch (IOException e) {
			e.printStackTrace();
			return false;
		} finally {
			scan.close();
		}

		return true;
	}

}
